
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Organization Portal</title>

  <!-- Teams JS SDK v2 -->
  <script src="https://res.cdn.office.net/teams-js/2.0.0/js/MicrosoftTeams.min.js"></script>
</head>

<body style="font-family:Segoe UI, Arial; padding:16px;">
  <h2>Organization portal</h2>
  <p>If you are not redirected automatically, click below.</p>

  <button id="open" style="padding:10px 14px; font-size:14px;">
    Open SharePoint
  </button>

  <script>
    const url = "https://m365t46240078.sharepoint.com/";

    function openInBrowser() {
      if (sessionStorage.getItem("portalOpened")) return;
      sessionStorage.setItem("portalOpened", "true");

      window.open(url, "_blank", "noopener,noreferrer");
    }

    function redirectHere() {
      window.location.replace(url);
    }

    async function init() {
      // If Teams SDK not present, do nothing
      if (!window.microsoftTeams?.app) return;

      try {
        await microsoftTeams.app.initialize();
        const context = await microsoftTeams.app.getContext();

        const host = context.app.host.name;

        if (host === "teams") {
          // Teams → open browser tab
          openInBrowser();
        }
        else if (host === "outlook") {
          // Outlook → redirect current view
          redirectHere();
        }
      } catch (e) {
        console.warn("Host detection failed:", e);
      }
    }

    // Button works everywhere
    document.getElementById("open").onclick = openInBrowser;

    // Auto-run
    init();
  </script>
</body>
</html>
