<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Organization Portal</title>

  <!-- Teams SDK (optional) -->
  <script src="https://res.cdn.office.net/teams-js/2.0.0/js/MicrosoftTeams.min.js"></script>
</head>

<body style="font-family:Segoe UI, Arial; padding:16px;">
  <h2>Organization portal</h2>
  <p>Click the button to open SharePoint in a new browser tab/window.</p>

  <button id="open" style="padding:12px 16px; font-size:14px;">
    Open SharePoint
  </button>

  <p style="margin-top:12px; font-size:13px;">
    If nothing happens, click this link:
    <a id="link" href="https://m365t46240078.sharepoint.com/" target="_blank" rel="noopener noreferrer">
      https://m365t46240078.sharepoint.com/
    </a>
  </p>

  <div id="msg" style="margin-top:10px; font-size:12px; opacity:.85;"></div>

  <script>
    const url = "https://m365t46240078.sharepoint.com/";
    const msg = document.getElementById("msg");
    const link = document.getElementById("link");
    link.href = url;
    link.textContent = url;

    function show(s) { msg.textContent = s; }

    async function openSharePoint() {
      show("");

      // 1) If running in Teams tab surface, this is the best supported external opener.
      try {
        if (window.microsoftTeams?.pages?.openLink) {
          // Don't call getContext. Don't wait on anything that can hang.
          try { await microsoftTeams.app.initialize(); } catch {}
          await microsoftTeams.pages.openLink(url);
          show("Requested Teams to open the link.");
          return;
        }
      } catch (e) {
        show("Teams openLink failed, trying browser fallbackâ€¦");
      }

      // 2) Browser fallback: programmatically click a real anchor (often more reliable than window.open in WebViews)
      try {
        link.click();
        show("Opened via browser link.");
        return;
      } catch {}

      // 3) Last resort
      const w = window.open(url, "_blank", "noopener,noreferrer");
      if (!w) show("Popup blocked. Please click the link shown above.");
    }

    document.getElementById("open").addEventListener("click", openSharePoint);
  </script>
</body>
</html>
